const { makeHandFromPattern } = require('./test-helpers');
const { SAYCBiddingSystem } = require('../js/combined-bidding-system');

/**
 * Weak two preempt discipline with vulnerability adjustments.
 */

describe('Weak Two vulnerability adjustments', () => {
  let system;

  beforeEach(() => {
    system = new SAYCBiddingSystem();
  });

  test('8 HCP 6 hearts opens 2H when equal vulnerability, but not when we are vulnerable', () => {
    // Equal vulnerability
    system.startAuction('N', false, false);
    const equalHand = makeHandFromPattern('Q32', 'KQJ987', '32', '32'); // ~8 HCP, 6 hearts
    const bidEqual = system.getBid(equalHand);
    expect(bidEqual && bidEqual.token).toBe('2H');

    // Unfavorable (we vulnerable)
    system.startAuction('N', true, false);
    const bidUnfav = system.getBid(equalHand);
    expect(!bidUnfav || bidUnfav.token !== '2H').toBe(true);
  });

  test('6 HCP 6 spades opens 2S when favorable vulnerability; not when unfavorable', () => {
    const hand = makeHandFromPattern('QJ9876', 'K32', '32', '32'); // ~6 HCP, 6 spades

    // Favorable (they vulnerable)
    system.startAuction('N', false, true);
    const favBid = system.getBid(hand);
    expect(favBid && favBid.token).toBe('2S');

    // Unfavorable (we vulnerable)
    system.startAuction('N', true, false);
    const unfavBid = system.getBid(hand);
    expect(!unfavBid || unfavBid.token !== '2S').toBe(true);
  });
});
