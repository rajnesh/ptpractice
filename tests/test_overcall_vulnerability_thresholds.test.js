const { makeHandFromPattern } = require('./test-helpers');
const { SAYCBiddingSystem } = require('../assets/js/combined-bidding-system');
const { Bid, Auction } = require('../assets/js/bridge-types');

/**
 * Overcall vulnerability thresholds: baseline 5 HCP at 1-level adjusted by vulnerability.
 */

describe('Overcall vulnerability thresholds', () => {
  let system;

  beforeEach(() => {
    system = new SAYCBiddingSystem();
  });

  test('Favorable: 5 HCP 5-card major over 1D -> allowed 1-level overcall', () => {
    system.startAuction('N', false, true); // favorable
  system.currentAuction = new Auction([], { dealer: 'S', ourSeat: 'N' });
  system.currentAuction.add(new Bid('1D'));

    const hand = makeHandFromPattern('KQJ32', '32', '32', '32'); // 5 spades, ~6 HCP
    const bid = system.getBid(hand);
    // Allow at or just above baseline when favorable
    expect(bid && bid.token).toBe('1S');
  });

  test('Unfavorable: 5 HCP 5-card major over 1D -> disallowed 1-level overcall', () => {
    system.startAuction('N', true, false); // unfavorable
  system.currentAuction = new Auction([], { dealer: 'S', ourSeat: 'N' });
  system.currentAuction.add(new Bid('1D'));

    const hand = makeHandFromPattern('QJ932', '32', '32', '32'); // 5 spades, ~4 HCP
    const bid = system.getBid(hand);
    // Should not overcall at 5 HCP when unfavorable
    expect(!bid || bid.token !== '1S').toBe(true);
  });
});
